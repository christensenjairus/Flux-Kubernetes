apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: redis
  namespace: harbor
spec:
  releaseName: harbor-redis
  values:
    redisReplication:
      name: "harbor-redis"

    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
                - key: "app.kubernetes.io/instance"
                  operator: "In"
                  values:
                    - "harbor-redis"
            topologyKey: "kubernetes.io/hostname"
